<!DOCTYPE html>
<html>
<head>
    <title>Videogame Ratings</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .button-container {
            display: flex;
            justify-content: space-around;
        }
    </style>
</head>
<body>
    <h1>Videogame Ratings</h1>

    <h2>Games</h2>

    <div id="game-list">
        </div>

    <script>
        // Use a base URL for your API, which can be easily changed for deployment
        const API_BASE_URL = 'http://127.0.0.1:8000'; // For local development

        // Function to fetch game data and populate the game list
        function fetchGames() {
            fetch (`${API_BASE_URL}/games/`) // Changed to local API endpoint
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(games => {
                let gameList = document.getElementById('game-list');
                if (games.length === 0) {
                    gameList.innerHTML = '<p>No games found. Add some from the API!</p>';
                    return;
                }
                let table = '<table><tr><th>ID</th><th>Name</th><th>Genre</th><th>Platform</th><th>Actions</th></tr>';
                games.forEach(game => {
                    table += `<tr>
                        <td>${game.game_id}</td>
                        <td>${game.game_name}</td>
                        <td>${game.genre}</td>
                        <td>${game.platform}</td>
                        <td>
                            <div class="button-container">
                                <button onclick="viewRatings(${game.game_id})">Ratings</button>
                                <button onclick="editGame(${game.game_id})">Edit</button>
                                <button onclick="deleteGame(${game.game_id})">Delete</button>
                            </div>
                        </td>
                    </tr>`;
                });
                table += '</table>';
                gameList.innerHTML = table;
            })
            .catch(error => {
                console.error('Error fetching games:', error);
                document.getElementById('game-list').innerHTML = '<p>Error loading games. Please ensure the backend is running.</p>';
            });
        }

        // Call fetchGames when the page loads
        document.addEventListener('DOMContentLoaded', fetchGames);

        // --- Keep these functions for later use, they are currently unused in this specific HTML ---
        // Handle form submission (This block should be moved to rating.html or a dedicated script for rating submission)
        // This part is commented out because there's no 'rating-form' in index.html
        /*
        document.getElementById('rating-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const gameId = document.getElementById('game_id').value;
            const rating = document.getElementById('rating').value;
            const comment = document.getElementById('comment').value;
            const ratingDate = document.getElementById('rating_date').value;

            fetch(`${API_BASE_URL}/ratings/me/`, { // Changed to local API endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc0MjkyMTU0NX0.Ksn7YhocTjpVhS5AZCupMqWTSqcekFiF-FKWEO01qHU' // Replace with actual JWT token
                },
                body: JSON.stringify({
                    game_id: parseInt(gameId),
                    rating: parseFloat(rating),
                    comment: comment,
                    rating_date: ratingDate
                })
            })
            .then(response => {
                if (response.ok) {
                    alert('Rating submitted successfully!');
                    // Optionally, re-fetch games or update UI here
                } else {
                    response.json().then(errorData => {
                        console.error('Failed to submit rating:', errorData);
                        alert(`Failed to submit rating: ${errorData.detail || response.statusText}`);
                    }).catch(() => {
                        alert(`Failed to submit rating. Status: ${response.status}`);
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred.');
            });
        });
        */

        function viewRatings(gameId) {
            // Implement logic to view ratings for the game, perhaps navigate to rating.html?game_id=...
            alert(`View ratings for game ID: ${gameId}`);
            // window.location.href = `/static/rating.html?game_id=${gameId}`; // Example navigation
        }

        function editGame(gameId) {
            // Implement logic to edit the game
            alert(`Edit game ID: ${gameId}`);
        }

        function deleteGame(gameId) {
            // Implement logic to delete the game
            alert(`Delete game ID: ${gameId}`);
        }
    </script>
</body>
</html>